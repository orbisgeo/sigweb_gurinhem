/* Definição de Variáveis CSS (Custom Properties) */
:root {
    --bg-body: #f9fafb; /* Cor de fundo para o corpo da página */
    --bg-white: #ffffff; /* Cor branca para fundos */
    --text-color: #111827; /* Cor principal para textos */
    --primary: #2563eb; /* Cor primária (azul) para elementos interativos */
    --dark: #111827; /* Cor escura para elementos como botões */
    --dark-hover: #1f2937; /* Cor para estado de hover de elementos escuros */
    --border-radius: 10px; /* Raio da borda para elementos arredondados */
    --box-shadow: 0 6px 20px rgba(0, 0, 0, .12); /* Sombra padrão para caixas */
    --font-main: 'Rubik', sans-serif; /* Fonte principal (com fallback) */
    --font-size-sm: 13px; /* Tamanho de fonte pequeno */
    --font-size-md: 14px; /* Tamanho de fonte médio */
}

/* Estilos Globais para HTML e Body */
html, body {
    height: 100%; /* Altura total da viewport */
    width: 100%; /* Largura total da viewport */
    margin: 0; /* Remove margens padrão do navegador */
    padding: 0; /* Remove preenchimento padrão do navegador */
    background: var(--bg-body); /* Aplica a cor de fundo definida na variável */
    overflow: hidden; /* Evita barras de rolagem no nível do corpo */
    font-family: var(--font-main); /* Aplica a fonte principal */
    color: var(--text-color); /* Aplica a cor de texto padrão */

    /* --- Aplicação do Zoom Out com transform: scale() --- */
    transform: scale(0.8); /* Diminui o zoom para 80% */
    transform-origin: top left; /* Escala a partir do canto superior esquerdo */
    width: 125%; /* Compensa o escalonamento (1 / 0.8 = 1.25) */
    height: 125%; /* Compensa o escalonamento */
    overflow: auto; /* Reabilita barras de rolagem se o conteúdo exceder */
    /* --- Fim da Aplicação do Zoom Out --- */
}

/* Estilos para o Elemento do Mapa */
#map {
    height: 100%; /* O mapa ocupa 100% da altura do pai */
    width: 100%; /* O mapa ocupa 100% da largura do pai */
    min-height: 200px; /* Altura mínima para o mapa */
    position: relative; /* Essencial para o posicionamento de controles internos */
}

/* Classes para o MODO IMPRESSÃO (Visualização em Tela) */
/* Quando o corpo está no modo de impressão, estas regras são aplicadas */
body.print-mode-active {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #e0e0e0; /* Fundo cinza claro para simular a área fora de uma folha A4 */
    display: flex; /* Usa Flexbox para centralizar o conteúdo */
    justify-content: center; /* Centraliza horizontalmente */
    align-items: center; /* Centraliza verticalmente */
    height: 100vh; /* Altura total da viewport */
    width: 100vw; /* Largura total da viewport */

    /* No modo de impressão, você provavelmente não quer o zoom out global */
    transform: none;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* Estilos para o Mapa no Modo Impressão */
/* Define o tamanho do mapa para simular um papel A4 na tela */
#map.print-mode-active {
    width: 794px !important; /* Largura A4 retrato em pixels (96 DPI) */
    height: 1123px !important; /* Altura A4 retrato em pixels (96 DPI) */
    position: relative !important; /* Manteve relativo para centralização do Flexbox */
    top: auto !important; /* Reseta o posicionamento absoluto */
    left: auto !important;
    transform: none !important; /* Reseta transformações */
    border: 1px solid #333; /* Borda para demarcar o "papel" */
    box-shadow: var(--box-shadow); /* Aplica sombra padrão */
    margin: 0 !important; /* Garante que o mapa não tenha margens */
}

/* FIM das classes para o MODO IMPRESSÃO */

/* * Estilos para o Contêiner do Formulário Principal (Ferramentas do Mapa)
* e o Contêiner de Busca (Busca de Feição)
*/
.form-container,
.search-container {
    position: absolute; /* Posicionamento absoluto em relação ao pai mais próximo com posição */
    z-index: 1000; /* Garante que fique acima de outros elementos */
    width: 260px; /* Largura padrão */
    background: var(--bg-white); /* Fundo branco */
    padding: 16px; /* Preenchimento interno */
    border-radius: var(--border-radius); /* Cantos arredondados */
    box-shadow: var(--box-shadow); /* Sombra */
}

.search-container {
    top: 16px; /* 16px do topo */
    left: 16px; /* 16px da esquerda */
}

.form-container {
    top: 16px; /* 16px do topo */
    right: 16px; /* 16px da direita */
}

/* Oculta Controles quando no Modo de Impressão */
/* Estas classes são adicionadas via JavaScript para esconder elementos específicos */
.form-container.hidden-for-print,
.custom-layer-control.hidden-for-print,
.search-container.hidden-for-print,
.print-mode-controls.hidden-for-print { /* Adicionado para garantir ocultar os controles de impressão também */
    display: none !important; /* Força o elemento a não ser exibido */
}

/* Estilos para Títulos dentro dos Contêineres de Formulário/Busca */
.form-container h4,
.search-container h4 {
    margin: 0 0 10px 0; /* Margem inferior para espaçamento */
    font-size: var(--font-size-md); /* Garante consistência */
}

/* Estilos para Labels dentro dos Contêineres de Formulário/Busca */
.search-container label {
    font-size: var(--font-size-md); /* Tamanho de fonte médio */
    margin-bottom: 5px; /* Margem inferior */
    display: block; /* Cada label ocupa sua própria linha */
}

/* Estilos para Inputs, Botões e Selects dentro dos Contêineres */
.form-container input, .form-container button, .form-container select,
.search-container select, .search-container input[type="text"], .search-container button {
    width: 100%; /* Largura total do pai */
    padding: 8px; /* Preenchimento interno */
    margin-bottom: 10px; /* Margem inferior */
    font-size: var(--font-size-md); /* Tamanho de fonte médio */
    border: 1px solid #cbd5e1; /* Borda */
    border-radius: var(--border-radius); /* Cantos arredondados */
    box-sizing: border-box; /* Inclui padding e border na largura e altura total */
}

/* Estilos específicos para Botões dentro dos Contêineres */
.form-container button,
.search-container button {
    font-weight: bold; /* Texto em negrito */
    border: none; /* Sem borda */
    cursor: pointer; /* Cursor de "mãozinha" ao passar por cima */
    background: var(--primary); /* Fundo primário */
    color: #fff; /* Cor do texto branca */
    transition: background 0.2s ease; /* Transição suave para o hover */
}

/* Estilo para Botão no Estado de Hover */
.form-container button:hover,
.search-container button:hover {
    background: var(--dark-hover); /* Altera o fundo para o hover */
}

/* Estilo para Botão de Apagar (Limpar Busca) */
.btn-apagar {
    background: #dc2626 !important; /* Fundo vermelho forte (sobrescreve outras regras) */
}
.btn-apagar:hover {
    background: #ef4444 !important; /* Hover para o botão apagar */
}

/* Estilo para Botão de Ordenar (se houver, mantido para consistência) */
.btn-ordenar {
    background: var(--primary); /* Fundo com a cor primária */
}

/* Estilo para a Tooltip (dica de ferramenta) do OpenLayers */
.ol-tooltip {
    position: relative; /* Permite posicionamento interno de pseudoelementos */
    background: rgba(255, 255, 255, .85); /* Fundo branco semi-transparente */
    padding: 2px 5px; /* Preenchimento */
    border-radius: 4px; /* Cantos arredondados */
    white-space: nowrap; /* Impede quebra de linha */
    font-weight: 600; /* Negrito */
    color: var(--text-color); /* Cor do texto */
    border: 1px solid #ccc; /* Borda */
    font-size: 11px; /* Tamanho de fonte pequeno */
}

/* Estilo para o Controle de Camadas Personalizado */
.custom-layer-control {
    position: absolute; /* Posicionamento absoluto */
    left: 16px; /* 16px da esquerda */
    bottom: 16px; /* **CORREÇÃO:** Ancorado ao fundo, mais responsivo */
    z-index: 1000; /* Acima de outros elementos */
    background: var(--bg-white); /* Fundo branco */
    padding: 10px; /* Preenchimento */
    border-radius: var(--border-radius); /* Cantos arredondados */
    box-shadow: var(--box-shadow); /* Sombra */
    font-size: var(--font-size-sm); /* Tamanho de fonte pequeno */
    max-height: calc(100vh - 200px); /* **CORREÇÃO:** Altura máxima responsiva */
    overflow-y: auto; /* **CORREÇÃO:** Adiciona barra de rolagem vertical se o conteúdo exceder */
    width: 200px; /* Define uma largura padrão para o controle de camadas */
}

/* Estilo para Labels dentro do Controle de Camadas */
.custom-layer-control label {
    display: block; /* Cada label ocupa sua própria linha */
    margin-bottom: 5px; /* Margem inferior */
    cursor: pointer; /* Cursor de "mãozinha" */
}

/* Estilo Básico para o Popup do OpenLayers */
.ol-popup {
    background-color: white; /* Fundo branco */
    border: 1px solid #cccccc; /* Borda cinza */
    padding: 10px; /* Preenchimento */
    box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Sombra sutil */
    border-radius: 5px; /* Cantos arredondados */
    min-width: 200px; /* Largura mínima */
}

/* Estilos para o Select dentro do SweetAlert2 (popup de exportação) */
.swal2-select {
    margin-top: 10px; /* Margem superior */
    margin-bottom: 15px; /* Margem inferior */
    width: auto !important; /* Ajusta a largura se for necessário */
    min-width: 150px;
}

/* Estilos para Labels de Rádio dentro do SweetAlert2 */
.swal2-radio label {
    display: block; /* Cada label de rádio ocupa sua própria linha */
    margin-bottom: 5px; /* Margem inferior */
}

/* Estilo para Tabela de Atributos no Popup */
.table-attributes {
    width: 100%; /* Ocupa 100% da largura do pai */
    border-collapse: collapse; /* Bordas da tabela se unem */
    margin-bottom: 10px; /* Margem inferior */
    font-size: var(--font-size-sm); /* Consistência com o tamanho da fonte */
}

/* Estilo para Células da Tabela de Atributos */
.table-attributes td {
    padding: 5px 0; /* Preenchimento vertical */
    vertical-align: top; /* Alinha o conteúdo ao topo da célula */
}

/* Estilo para Nomes de Atributos na Tabela */
.table-attributes strong {
    display: block; /* Ocupa sua própria linha */
    margin-bottom: 3px; /* Margem inferior */
}

/* Estilo para Valores de Atributos na Tabela (somente visualização) */
.table-attributes .attribute-value {
    padding: 5px; /* Preenchimento */
    border: 1px solid #eee; /* Borda suave */
    border-radius: 3px; /* Cantos arredondados */
    background-color: #f9f9f9; /* Fundo claro */
    display: block; /* Ocupa a largura total */
    word-wrap: break-word; /* Quebra palavras longas */
}

/* Estilos para Lista de Campos no Popup (Gerenciamento de Campos) */
.field-list {
    list-style: none; /* Remove marcadores de lista */
    padding: 0; /* Remove preenchimento */
    margin: 10px 0; /* Margens vertical */
    max-height: 200px; /* Altura máxima com barra de rolagem */
    overflow-y: auto; /* Adiciona barra de rolagem vertical se o conteúdo exceder */
    border: 1px solid #eee; /* Borda */
    border-radius: 5px; /* Cantos arredondados */
    font-size: var(--font-size-md); /* Garante consistência */
}

/* Estilo para Itens da Lista de Campos */
.field-list li {
    padding: 8px 10px; /* Preenchimento */
    display: flex; /* Usa Flexbox */
    justify-content: space-between; /* Espaça os itens */
    align-items: center; /* Alinha verticalmente no centro */
    border-bottom: 1px solid #eee; /* Borda inferior */
}

/* Remove Borda do Último Item da Lista */
.field-list li:last-child {
    border-bottom: none;
}

/* Estilo para Botões dentro dos Itens da Lista de Campos */
.field-list li button {
    background-color: #dc2626; /* Fundo vermelho */
    color: white; /* Texto branco */
    border: none; /* Sem borda */
    border-radius: 3px; /* Cantos arredondados */
    padding: 3px 8px; /* Preenchimento */
    cursor: pointer; /* Cursor de "mãozinha" */
    font-size: var(--font-size-sm); /* Tamanho de fonte pequeno */
    margin-left: 10px; /* Margem à esquerda */
    width: auto; /* Largura automática */
    margin-bottom: 0; /* Remove margem inferior padrão de botões */
    transition: background 0.2s ease;
}

/* Estilo para Botão no Estado de Hover na Lista de Campos */
.field-list li button:hover {
    background-color: #ef4444; /* Altera fundo para hover */
}

/* Estilo para Seção de Adicionar Campo */
.add-field-section {
    margin-top: 15px; /* Margem superior */
    border-top: 1px solid #eee; /* Borda superior */
    padding-top: 10px; /* Preenchimento superior */
}

/* Estilos para Ferramentas de Medição (Tooltips) */
.ol-tooltip-measure {
    background: rgba(255, 255, 255, 0.85); /* Fundo branco semi-transparente */
    color: black; /* Cor do texto preta */
    padding: 4px 8px; /* Preenchimento */
    border-radius: 4px; /* Cantos arredondados */
    white-space: nowrap; /* Impede quebra de linha */
    font-size: 14px; /* Tamanho de fonte */
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); /* Sombra */
    pointer-events: none; /* Não interage com eventos do mouse */
}

/* Estilo para Tooltip de Medição Estática (finalizada) */
.ol-tooltip-static {
    background-color: #ffcc33; /* Fundo amarelo */
    color: black; /* Texto preto */
    border: 1px solid white; /* Borda branca */
}

/* Pseudo-elementos para criar a "seta" na parte inferior da tooltip */
.ol-tooltip-measure:before,
.ol-tooltip-static:before {
    border-top: 6px solid rgba(255, 255, 255, 0.85); /* Cria a base da seta */
    border-right: 6px solid transparent; /* Lado direito transparente */
    border-left: 6px solid transparent; /* Lado esquerdo transparente */
    content: ""; /* Conteúdo vazio para exibir o pseudoelemento */
    position: absolute; /* Posicionamento absoluto */
    bottom: -6px; /* Posiciona abaixo do elemento principal */
    margin-left: -7px; /* Centraliza a seta horizontalmente */
    left: 50%; /* Começa no centro horizontal */
}

/* Ajusta a cor da seta para a tooltip estática */
.ol-tooltip-static:before {
    border-top-color: #ffcc33; /* Cor da seta amarela */
}

/* Estilos para a Interface de Usuário do Modo de Impressão */
.print-mode-controls {
    position: absolute; /* Posicionamento absoluto */
    top: 16px; /* 16px do topo */
    left: 50%; /* No centro horizontal */
    transform: translateX(-50%); /* Ajusta para centralizar perfeitamente */
    z-index: 1001; /* Acima de outros controles */
    background: var(--bg-white); /* Fundo branco */
    padding: 10px 20px; /* Preenchimento */
    border-radius: var(--border-radius); /* Cantos arredondados */
    box-shadow: var(--box-shadow); /* Sombra */
    display: none; /* Oculto por padrão */
    white-space: nowrap; /* Impede quebra de linha para os botões */
}

/* Estilo para Botões dentro dos Controles de Impressão */
.print-mode-controls button {
    margin: 0 5px; /* Margem horizontal entre botões */
    width: auto; /* Largura automática (anula o 100%) */
    display: inline-block; /* Permite que fiquem na mesma linha */
    padding: 8px 15px; /* Preenchimento */
    font-size: var(--font-size-md); /* Tamanho de fonte médio */
}

/* Estilo para a Seta do Norte (Modo Impressão) */
#northArrowPrint {
    position: absolute; /* Posicionamento absoluto */
    top: 20px; /* 20px do topo */
    right: 20px; /* 20px da direita */
    font-size: 3em; /* Tamanho grande da fonte */
    color: #333; /* Cor escura */
    z-index: 1000; /* Acima de outros elementos */
    display: none; /* Oculto por padrão */
    font-weight: bold; /* Texto em negrito */
    text-shadow: 0 0 2px rgba(255,255,255,0.7); /* Sombra no texto para contraste */
}

/* Estilo Padrão para a Escala do OpenLayers (oculta por padrão) */
.ol-scale-line {
    display: none; /* Oculta a escala por padrão no modo normal */
}

/* Torna a Escala Visível e Posiciona para o Modo de Impressão */
.ol-scale-line.visible-for-print {
    display: block !important; /* Força a exibição */
    position: absolute; /* Posicionamento absoluto */
    bottom: 20px; /* 20px do fundo */
    left: 20px; /* 20px da esquerda */
    background: rgba(255, 255, 255, 0.8); /* Fundo branco semi-transparente */
    padding: 5px; /* Preenchimento */
    border-radius: 5px; /* Cantos arredondados */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Sombra */
    z-index: 1000; /* Acima de outros elementos */
}

/* CSS para a Impressão Real (quando window.print() é chamada) */
@media print {
    /* Regras para a página de impressão */
    @page {
        size: A4 portrait; /* Define o tamanho da página como A4 retrato */
        margin: 0 !important; /* Remove margens do navegador na impressão */
    }

    /* Estilos para HTML e Body na Impressão */
    html, body {
        height: 100% !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: hidden !important; /* Remove barras de rolagem */
        transform: none !important; /* Remove o zoom out ao imprimir */
    }

    /* Estilos para o Mapa na Impressão */
    #map {
        width: 210mm !important; /* Largura A4 em milímetros */
        height: 297mm !important; /* Altura A4 em milímetros */
        position: absolute !important; /* Garante que o mapa ocupe toda a página */
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        transform: none !important;
        border: none !important;
        box-shadow: none !important;
        margin: 0 !important;
    }

    /* Oculta Elementos que Não Devem Aparecer na Impressão */
    .form-container, .custom-layer-control, .print-mode-controls,
    .ol-zoom, .ol-rotate, .ol-attribution,
    .ol-tooltip, .ol-tooltip-help, .ol-tooltip-measure, .search-container {
        display: none !important; /* Esconde completamente */
    }

    /* Garante que Seta do Norte e Escala Gráfica Sejam Visíveis na Impressão */
    #northArrowPrint, .ol-scale-line {
        display: block !important; /* Força a exibição */
    }

    /* Ajusta a Posição Final da Escala Gráfica para a Impressão */
    .ol-scale-line {
        bottom: 20px !important; /* Posiciona no fundo */
        left: 20px !important; /* Posiciona à esquerda */
        right: auto !important;
    }

    /* Ajusta a Posição Final da Seta do Norte para a Impressão */
    #northArrowPrint {
        top: 20px !important; /* Posiciona no topo */
        right: 20px !important; /* Posiciona à direita */
        left: auto !important;
    }
}

/* * =========================================================================
* MEDIA QUERIES PARA RESPONSIVIDADE (PRINCIPAIS CORREÇÕES AQUI)
* =========================================================================
*/

/* Para telas médias (tablets em modo paisagem, notebooks pequenos) */
@media (max-width: 1024px) {
    .form-container,
    .search-container {
        width: 240px; /* Ligeiramente menor para telas médias */
        padding: 14px;
    }

    .form-container input, .form-container button, .form-container select,
    .search-container select, .search-container input[type="text"], .search-container button {
        padding: 7px;
        margin-bottom: 8px;
        font-size: var(--font-size-sm);
    }

    .form-container h4, .search-container h4 {
        font-size: var(--font-size-md);
    }

    .custom-layer-control {
        width: 180px; /* Largura um pouco menor */
        padding: 8px;
        font-size: 12px; /* Reduz fonte para ganhar espaço */
        max-height: calc(100vh - 180px); /* Ajusta max-height */
    }

    .custom-layer-control label {
        margin-bottom: 3px;
    }
}

/* Para telas pequenas (tablets em modo retrato, celulares grandes) */
@media (max-width: 768px) {
    /* Centraliza e ocupa mais espaço horizontal */
    .form-container,
    .search-container {
        width: calc(100% - 32px); /* 100% da largura menos o padding */
        left: 16px; /* Mantém 16px de cada lado */
        right: 16px;
        transform: none; /* Remove qualquer transformação de centralização se houver */
        padding: 12px;
        /* Por padrão, eles podem empilhar se o top for o mesmo */
    }

    /* Ajusta a posição vertical em telas menores para não se sobreporem tanto */
    .search-container {
        top: 16px; /* Permanece no topo */
    }

    .form-container {
        top: auto; /* Remove o top fixo */
        bottom: 16px; /* Mova para a parte inferior direita */
        /* Alternativa: se quiser que eles empilhem um abaixo do outro na parte superior */
        /* top: 100px; Ajuste conforme a altura do search-container + margem */
    }

    /* Controle de camadas também na parte inferior, mas à esquerda */
    .custom-layer-control {
        width: calc(100% - 32px); /* Ocupa a largura total da tela, com padding */
        left: 16px;
        right: 16px;
        bottom: 16px; /* Ancorado ao fundo */
        max-height: calc(50vh - 32px); /* Limita a altura para 50% da viewport */
        padding: 10px;
        font-size: var(--font-size-sm);
    }
}

/* Para telas muito pequenas (celulares) */
@media (max-width: 480px) {
    /* As larguras já estão em 100% - 32px, então focamos na organização vertical */
    .search-container {
        top: 10px; /* Um pouco menos de margem no topo */
        left: 10px;
        right: 10px;
        width: calc(100% - 20px);
        padding: 10px;
        /* Considerar implementar um botão "menu" para expandir/recolher este painel */
    }

    .form-container {
        /* Para mobile, é muito provável que este painel precise ser ocultado por padrão e aberto via um botão de "menu" */
        /* Por enquanto, vamos posicioná-lo abaixo do search-container ou em uma posição discreta */
        top: calc(10px + 100px + 10px); /* Exemplo: Altura do search-container + margens */
        /* O valor '100px' acima é um PALPITE, você precisaria medir a altura real do .search-container */
        left: 10px;
        right: 10px;
        width: calc(100% - 20px);
        padding: 10px;
    }

    /* Uma alternativa melhor para mobile seria um botão para mostrar/esconder */
    /* Exemplo: .form-container.is-hidden { display: none; } */

    .custom-layer-control {
        bottom: 10px; /* Ancorado mais perto da borda inferior */
        left: 10px;
        right: 10px;
        width: calc(100% - 20px);
        max-height: calc(40vh - 20px); /* Ajusta max-height para telas menores */
        padding: 8px;
        font-size: var(--font-size-sm);
    }
}

/* * Exemplo de classes para recolher/expandir (precisam de JS para alternar)
* Você precisaria de um botão/ícone para adicionar/remover a classe 'is-collapsed'
*/
.collapsible-panel {
    transition: all 0.3s ease-in-out;
    overflow: hidden;
}

.collapsible-panel.is-collapsed {
    height: 40px; /* Altura do cabeçalho quando colapsado */
    padding-bottom: 0;
}

.collapsible-panel.is-collapsed .panel-content {
    display: none; /* Oculta o conteúdo quando colapsado */
}

/* Adicionar um botão de toggle se for implementar colapsibilidade */
/* Ex: Botão dentro do h4 para expandir/recolher */
.panel-header-toggle {
    cursor: pointer;
    float: right; /* Alinha à direita do título */
    /* Estilos de ícone (ex: seta para cima/baixo) */
}
